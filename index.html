<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Provably Fair Prüfer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      background-color: #121212;
      color: #e0e0e0;
    }
    input, button, select, textarea {
      padding: 10px;
      width: 100%;
      margin-top: 10px;
      margin-bottom: 20px;
      background-color: #1e1e1e;
      color: #fff;
      border: 1px solid #333;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    pre {
      background: #1e1e1e;
      padding: 10px;
      white-space: pre-wrap;
      border: 1px solid #333;
    }
  </style>
</head>
<body>
  <h1>Provably Fair Prüfer</h1>
  <label for="gameMode">Spielmodus:</label>
  <select id="gameMode">
    <option value="PVP_BOX">PVP_BOX</option>
    <option value="UNBOXING">UNBOXING</option>
  </select>

  <label for="serverSeed">Server Seed (offenbart):</label>
  <input type="text" id="serverSeed">

  <label for="serverSeedHash">SHA256 Hash des Server Seeds (vor Spiel):</label>
  <input type="text" id="serverSeedHash">

  <label for="clientSeed">Client Seed (EOS Hash):</label>
  <input type="text" id="clientSeed">

  <label for="nonce">PvP Bet ID (Nonce):</label>
  <input type="number" id="nonce">

  <button onclick="verifySeed()">Prüfen</button>

  <h2>Ergebnis</h2>
  <pre id="output"></pre>

  <script>
    async function verifySeed() {
      const gameMode = document.getElementById('gameMode').value;
      const serverSeed = document.getElementById('serverSeed').value.trim();
      const serverSeedHash = document.getElementById('serverSeedHash').value.trim();
      const clientSeed = document.getElementById('clientSeed').value.trim();
      const nonce = document.getElementById('nonce').value.trim();

      const output = document.getElementById('output');
      output.textContent = '';

      if (!serverSeed || !serverSeedHash || !clientSeed || !nonce) {
        output.textContent = 'Bitte alle Felder ausfüllen.';
        return;
      }

      const hashBuffer = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(serverSeed));
      const actualHash = Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');

      if (actualHash !== serverSeedHash.toLowerCase()) {
        output.textContent = '❌ Server Seed stimmt NICHT mit seinem Hash überein!\nErwartet: ' + serverSeedHash + '\nTatsächlich: ' + actualHash;
        return;
      }

      const combinedSeed = `${gameMode}-${serverSeed}-${clientSeed}-${nonce}`;
      const encoder = new TextEncoder();
      const key = encoder.encode(combinedSeed);
      const hmacKey = await crypto.subtle.importKey("raw", key, { name: "HMAC", hash: "SHA-256" }, false, ["sign"]);
      const hmac = await crypto.subtle.sign("HMAC", hmacKey, key);
      const hashHex = Array.from(new Uint8Array(hmac)).map(b => b.toString(16).padStart(2, '0')).join('');

      const subHash = hashHex.slice(0, 13);
      const valueFromHash = parseInt(subHash, 16);
      const e = Math.pow(2, 52);
      const result = Math.floor((valueFromHash / e) * 1e8);

      const totalTickets = 100000000;
      output.textContent = `✅ Verifikation erfolgreich!\n\nRoll-Wert: ${result} (Ticket ${result} von ${totalTickets})\n\nHash überprüft: ${actualHash === serverSeedHash.toLowerCase()}`;
    }
  </script>
</body>
</html>
